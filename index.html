<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>H·ªá Th·ªëng Tr·∫Øc Nghi·ªám + T·ª± Lu·∫≠n</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --primary:#6366f1; /* ƒë·ªïi b·∫±ng color picker */
      --primary-dark:#4f46e5;
      --bg:#f1f5f9;
      --card:#fff;
      --txt:#0f172a;
      --muted:#64748b;
      --radius:14px;
      --shadow:0 6px 18px rgb(0 0 0/.08);
      --t:all .25s cubic-bezier(.4,0,.2,1)
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:"Inter",sans-serif;background:var(--bg);color:var(--txt)}
    #app{height:100%;display:flex;align-items:center;justify-content:center;padding:16px}
    .card{width:92vw;max-width:980px;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);display:flex;flex-direction:column;overflow:hidden;position:relative}
    header{background:linear-gradient(135deg,var(--primary)0%,var(--primary-dark)100%);padding:20px;color:#fff;display:flex;justify-content:center;align-items:center;position:relative}
    header h1{margin:0;font-size:1.8rem;font-weight:700;letter-spacing:.2px}
    #gear,#userBtn{position:absolute;top:18px;width:42px;height:42px;border:none;border-radius:50%;background:rgba(255,255,255,.15);backdrop-filter:blur(4px);display:grid;place-items:center;font-size:22px;cursor:pointer}
    #gear{right:20px} #userBtn{left:20px}
    #gear:hover,#userBtn:hover{background:rgba(255,255,255,.25);transform:translateY(-1px)}/* Settings */
#settings{position:absolute;top:74px;right:20px;background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;width:260px;display:none;z-index:30}
#settings .btn{width:100%;margin-top:10px}

.screen{padding:28px;overflow-y:auto;flex:1;animation:fadeSlide .4s}
.hidden{display:none !important}

input,textarea,select{width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:var(--radius);font-size:1rem;margin:10px 0;transition:var(--t);background:#fff}
textarea{min-height:110px}
input:focus,textarea:focus,select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgb(99 102 241/.22)}

.btn{background:var(--primary);color:#fff;border:none;border-radius:var(--radius);padding:12px 20px;font-weight:600;cursor:pointer;transition:var(--t);box-shadow:0 2px 6px rgb(0 0 0/.1);position:relative;overflow:hidden}
.btn:hover{background:var(--primary-dark);transform:translateY(-1px)}
.btn:active{transform:translateY(0)}

/* Cards */
.qcard{background:#fff;border:2px solid transparent;border-radius:var(--radius);padding:18px;margin-bottom:20px;box-shadow:var(--shadow);position:relative;transition:var(--t)}
.qcard:hover{border-color:var(--primary);transform:translateY(-2px)}
.qcard h3{margin:0 0 14px;font-size:1.05rem;font-weight:700}

/* Actions */
.actions{position:absolute;top:10px;right:12px;display:flex;gap:10px;font-size:18px;color:var(--muted)}
.actions span{cursor:pointer;transition:var(--t)}
.actions span:hover{color:var(--primary);transform:scale(1.15)}

/* Multiple choice options */
.optwrap{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.opt{border:2px solid var(--primary);border-radius:var(--radius);padding:12px;text-align:left;background:#f8fafc;cursor:pointer;transition:var(--t);user-select:none}
.opt.selected{background:var(--primary);color:#fff;transform:scale(1.02)}

/* Result states */
.correct{outline:2px solid #16a34a;animation:pop .35s}
.wrong{outline:2px solid #ef4444;animation:shake .35s}

/* Login modal */
#login{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:40}
#loginBox{background:#fff;padding:32px;border-radius:var(--radius);width:90%;max-width:380px;box-shadow:var(--shadow);text-align:center;position:relative}
#closeLogin{position:absolute;top:10px;right:12px;font-size:22px;color:var(--muted);cursor:pointer;transition:var(--t)}
#closeLogin:hover{color:var(--primary);transform:scale(1.15)}

/* Small chips */
.chip{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:600;font-size:.8rem;margin-left:8px}

/* Progress bar */
.progress{height:8px;background:#e2e8f0;border-radius:999px;overflow:hidden;margin:8px 0 18px}
.progress > span{display:block;height:100%;background:linear-gradient(90deg,var(--primary),var(--primary-dark));width:0%;transition:width .4s ease}

/* Image preview */
#imgPreview{max-width:100%;max-height:150px;margin-top:6px;border-radius:var(--radius)}
.remove-img{margin-left:8px;cursor:pointer;color:#e11d48;background:none;border:none;font-size:14px}

/* Animations */
@keyframes fadeSlide{0%{opacity:0;transform:translateY(10px)}100%{opacity:1;transform:translateY(0)}}
@keyframes pop{0%{transform:scale(.98)}100%{transform:scale(1)}}
@keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-3px)}40%,60%{transform:translateX(3px)}}

@media(max-width:640px){
  .card{width:100vw;border-radius:0}
  .optwrap{grid-template-columns:1fr}
}

  </style>
</head>
<body>
<div id="app">
  <div id="card" class="card">
    <header>
      <button id="userBtn" type="button" title="ƒêƒÉng nh·∫≠p/nh·∫≠p t√™n">üë§</button>
      <h1>H·ªá Th·ªëng Tr·∫Øc Nghi·ªám <span class="chip">+ T·ª± lu·∫≠n</span></h1>
      <button id="gear" type="button" title="C√†i ƒë·∫∑t">‚öôÔ∏è</button>
    </header><!-- LOGIN -->
<div id="login" class="hidden">
  <div id="loginBox">
    <span id="closeLogin">‚úñ</span>
    <h2 style="margin:28px 0 6px">Nh·∫≠p t√™n ng∆∞·ªùi l√†m b√†i</h2>
    <p style="margin:0 0 12px;color:var(--muted)">T√™n s·∫Ω hi·ªÉn th·ªã trong k·∫øt qu·∫£</p>
    <input id="nameInp" placeholder="T√™n c·ªßa b·∫°n" spellcheck>
    <button id="startBtn" class="btn" style="margin-top:12px;width:100%" type="button">B·∫Øt ƒë·∫ßu l√†m b√†i</button>
  </div>
</div>

<!-- SETTINGS -->
<div id="settings">
  <button id="toggleSQ" class="btn" type="button">X√°o c√¢u h·ªèi: B·∫≠t</button>
  <button id="toggleSA" class="btn" type="button">X√°o ƒë√°p √°n: B·∫≠t</button>
  <button id="toggleSpell" class="btn" type="button">Spellcheck: B·∫≠t</button>
  <button id="fsBtn" class="btn" type="button">To√†n m√†n h√¨nh</button>
  <input id="colorPick" type="color" value="#6366f1" style="margin-top:12px;width:100%">
</div>

<!-- SETUP -->
<div id="setup" class="screen">
  <div style="display:flex;gap:10px;flex-wrap:wrap">
    <button id="modeBtn" class="btn" style="background:#38bdf8" type="button">Nh·∫≠p nhanh</button>
    <button id="viewBtn" class="btn" style="background:#1163ff" type="button">ƒê·ªÅ hi·ªán t·∫°i</button>
  </div>

  <div id="manual" style="margin-top:12px">
    <label style="font-weight:700">Lo·∫°i c√¢u h·ªèi</label>
    <select id="qType">
      <option value="mcq">Tr·∫Øc nghi·ªám 4 ƒë√°p √°n</option>
      <option value="essay">T·ª± lu·∫≠n</option>
    </select>

    <!-- MCQ fields -->
    <div id="mcqFields">
      <input id="qInp" placeholder="C√¢u h·ªèi">
      <input id="a0" placeholder="ƒê√°p √°n A"><input id="a1" placeholder="ƒê√°p √°n B">
      <input id="a2" placeholder="ƒê√°p √°n C"><input id="a3" placeholder="ƒê√°p √°n D">
      <label>ƒê√°p √°n ƒë√∫ng</label>
      <select id="correctSel"></select>
      <!-- Image upload -->
      <input id="imgInp" type="file" accept="image/*">
      <img id="imgPreview" class="hidden"/>
      <button id="clearImg" class="remove-img hidden" type="button">X√≥a ·∫£nh</button>
    </div>

    <!-- ESSAY fields -->
    <div id="essayFields" class="hidden">
      <textarea id="essayQ" placeholder="C√¢u h·ªèi t·ª± lu·∫≠n"></textarea>
      <textarea id="essayModel" placeholder="ƒê√°p √°n m·∫´u (ƒë·ªÉ g·ª£i √Ω v√† so kh·ªõp th√¥ng minh)"></textarea>
      <input id="essayKeywords" placeholder="T·ª´ kho√° b·∫Øt bu·ªôc (ph√¢n t√°ch b·∫±ng d·∫•u ph·∫©y)">
      <div style="display:flex;gap:10px;align-items:center">
        <input id="essayPoints" type="number" min="1" value="10" style="max-width:120px" placeholder="Thang ƒëi·ªÉm">
        <span style="color:var(--muted)">m·∫∑c ƒë·ªãnh 10 ƒëi·ªÉm</span>
      </div>
    </div>
    <button id="addBtn" class="btn" style="margin-top:8px" type="button">Th√™m c√¢u h·ªèi</button>
  </div>

  <!-- BULK IMPORT -->
  <div id="bulk" class="hidden" style="margin-top:12px">
    <textarea id="bulkArea" rows="6" placeholder="D√°n ƒë·ªãnh d·∫°ng nhanh‚Ä¶\nV√≠ d·ª•:\nC√¢u 1: 2+2=?\n*A. 4\nB. 5\nC. 3\nD. 6"></textarea>
    <button id="importBtn" class="btn" style="margin-top:6px" type="button">Import nhanh</button>
  </div>

  <p id="count" style="margin-top:10px;font-weight:600"></p>
</div>

<!-- VIEW -->
<div id="view" class="screen hidden">
  <h2 style="margin-bottom:10px">ƒê·ªÅ hi·ªán t·∫°i</h2>
  <div id="viewList"></div>
  <div id="clearAllWrap"></div>
  <button id="backSetup" class="btn" style="background:#64748b" type="button">Quay l·∫°i ch·ªânh ƒë·ªÅ</button>
</div>

<!-- QUIZ -->
<div id="quiz" class="screen hidden">
  <div class="progress"><span id="progbar"></span></div>
  <div id="quizList"></div>
  <button id="submitBtn" class="btn" style="margin-top:10px" type="button">N·ªôp b√†i</button>
</div>

<!-- RESULT -->
<div id="result" class="screen hidden">
  <h2>K·∫øt qu·∫£</h2>
  <p id="resultTxt" style="font-size:1.2rem;font-weight:700"></p>
  <div style="margin-top:14px;display:flex;gap:12px;flex-wrap:wrap">
    <button id="retryBtn" class="btn" style="flex:1" type="button">L√†m l·∫°i</button>
    <button id="homeBtn" class="btn" style="flex:1;background:#64748b" type="button">Trang ch·ªß</button>
    <button id="viewAnswerBtn" class="btn" style="flex:1;background:#38bdf8" type="button">Xem ƒë√°p √°n</button>
  </div>
</div>

<!-- ANSWER REVIEW -->
<div id="answerReview" class="screen hidden">
  <h2>ƒê√°p √°n chi ti·∫øt</h2>
  <div id="answerList"></div>
  <button id="backResultBtn" class="btn" style="margin-top:14px;background:#64748b" type="button">Quay l·∫°i k·∫øt qu·∫£</button>
</div>

  </div>
</div><script>
(function(){
  const $=id=>document.getElementById(id);
  let qs=[],score=0,shuffleQ=true,shuffleA=true,spell=true, editIndex=null;
  const LS_KEY = 'tao-cau-hoi-trac-nghiem-qs-v2';

  // ===== Utils =====
  function saveToStorage(){ localStorage.setItem(LS_KEY, JSON.stringify(qs)); }
  function loadFromStorage(){ try{ const data = JSON.parse(localStorage.getItem(LS_KEY)); if(Array.isArray(data)) qs=data; }catch{} }
  function updateCount(){ $('count').textContent=`${qs.length} c√¢u h·ªèi`; }
  function resetMCQ(){ $('qInp').value='';['a0','a1','a2','a3'].forEach(id=>$(id).value='');$('correctSel').value=0; $('imgInp').value=''; $('imgPreview').classList.add('hidden'); $('clearImg').classList.add('hidden'); }
  function resetEssay(){ ['essayQ','essayModel','essayKeywords'].forEach(id=>$(id).value=''); $('essayPoints').value=10; }
  function resetManual(){ resetMCQ(); resetEssay(); editIndex=null; }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
  function show(k){ Object.values(screens).forEach(s=>s.classList.toggle('hidden',s!==screens[k])); }
  const screens={ setup:$('setup'),view:$('view'),quiz:$('quiz'),result:$('result'),answerReview:$('answerReview') };

  // VN text normalize (for smart matching)
  const normalize=(s)=> s.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').replace(/ƒë/g,'d').replace(/[^a-z0-9\s]/g,' ').replace(/\s+/g,' ').trim();
  const tokenize=(s)=> normalize(s).split(' ').filter(Boolean);
  function jaccardSim(a,b){ const A=new Set(a),B=new Set(b); const inter=[...A].filter(x=>B.has(x)).length; const union=A.size+B.size-inter; return union? inter/union : 0; }

  // lightweight synonyms (vi) ‚Äì c√≥ th·ªÉ m·ªü r·ªông th√™m
  const SYN = {
    "nguyen nhan":["ly do","cause","do dau"],
    "giai phap":["cach khac phuc","cach giai quyet","solution"],
    "uu diem":["diem manh","loi the"],
    "nhuoc diem":["han che","bat loi"],
  };
  function expandKeywords(keywords){
    const out=new Set();
    keywords.forEach(k=>{ const nk=normalize(k); out.add(nk); if(SYN[nk]) SYN[nk].forEach(x=>out.add(normalize(x))); });
    return [...out];
  }

  // ===== INIT =====
  document.addEventListener('DOMContentLoaded', function(){
    loadFromStorage(); updateCount();
    for(let i=0;i<4;i++){ const o=document.createElement('option'); o.value=i; o.textContent=String.fromCharCode(65+i); $('correctSel').appendChild(o); }
  });

  // Image preview
  $('imgInp').onchange = function(e){ const file=e.target.files[0]; if(file){ const url=URL.createObjectURL(file); $('imgPreview').src=url; $('imgPreview').classList.remove('hidden'); $('clearImg').classList.remove('hidden'); }};
  $('clearImg').onclick = function(){ $('imgInp').value=''; $('imgPreview').src=''; $('imgPreview').classList.add('hidden'); $('clearImg').classList.add('hidden'); };

  // Login
  $('userBtn').onclick=()=>$('login').classList.remove('hidden');
  $('closeLogin').onclick=()=>$('login').classList.add('hidden');
  $('login').onclick=(e)=>{ if(e.target.id==='login')$('login').classList.add('hidden'); };

  $('startBtn').onclick=function(){
    if(!$('nameInp').value.trim()) return alert('Nh·∫≠p t√™n');
    if(!qs.length) return alert('H√£y nh·∫≠p c√¢u h·ªèi tr∆∞·ªõc!');
    $('login').classList.add('hidden');
    // shuffle
    if(shuffleQ) shuffle(qs);
    if(shuffleA) qs.forEach(q=>{ if(q.type==='mcq'){ const p=q.options.map((o,i)=>({o,i})); shuffle(p); q.options=p.map(x=>x.o); q.correct=p.findIndex(x=>x.i===q.correct); }});
    renderQuiz(); show('quiz');
  };

  // Settings
  $('gear').onclick=function(e){ e.stopPropagation(); $('settings').style.display=$('settings').style.display==='block'?'none':'block'; };
  document.addEventListener('click',e=>{ if($('settings') && !$('settings').contains(e.target) && e.target!==$('gear')) $('settings').style.display='none'; });
  $('colorPick').oninput=(e)=> document.documentElement.style.setProperty('--primary',e.target.value);
  $('toggleSQ').onclick=function(){ shuffleQ=!shuffleQ; this.textContent=`X√°o c√¢u h·ªèi: ${shuffleQ?'B·∫≠t':'T·∫Øt'}`; };
  $('toggleSA').onclick=function(){ shuffleA=!shuffleA; this.textContent=`X√°o ƒë√°p √°n: ${shuffleA?'B·∫≠t':'T·∫Øt'}`; };
  $('toggleSpell').onclick=function(){ spell=!spell; ['nameInp'].forEach(id=>$(id).spellcheck=spell); this.textContent=`Spellcheck: ${spell?'B·∫≠t':'T·∫Øt'}`; };
  $('fsBtn').onclick=function(){ const c=$('card'); if(!document.fullscreenElement){ c.requestFullscreen(); this.textContent='Tho√°t FS'; }else{ document.exitFullscreen(); this.textContent='To√†n m√†n h√¨nh'; } };

  // Mode switch
  $('modeBtn').onclick=function(){ const manualHidden=$('manual').classList.toggle('hidden'); $('bulk').classList.toggle('hidden'); this.textContent=manualHidden?'Nh·∫≠p nhanh':'Nh·∫≠p th·ªß c√¥ng'; };
  $('qType').onchange=function(){ const t=this.value; $('mcqFields').classList.toggle('hidden', t!=='mcq'); $('essayFields').classList.toggle('hidden', t!=='essay'); };

  // Add question
  $('addBtn').onclick=function(){
    const type=$('qType').value;
    if(type==='mcq'){
      const qText=$('qInp').value.trim(); const opts=['a0','a1','a2','a3'].map(id=>$(id).value.trim()); const ci=+$('correctSel').value; if(!qText||opts.some(o=>!o)) return alert('Thi·∫øu d·ªØ li·ªáu tr·∫Øc nghi·ªám'); const imgSrc=$('imgPreview').src||null; const item={type:'mcq',question:qText,options:opts,correct:ci,image:imgSrc};
      if(editIndex!=null){ qs[editIndex]=item; editIndex=null; } else qs.push(item);
      resetMCQ();
    } else {
      const q=$('essayQ').value.trim(); const model=$('essayModel').value.trim(); const kwRaw=$('essayKeywords').value.trim(); const points=Math.max(1, +$('essayPoints').value||10);
      if(!q) return alert('Thi·∫øu c√¢u h·ªèi t·ª± lu·∫≠n');
      const keywords = kwRaw ? kwRaw.split(',').map(s=>s.trim()).filter(Boolean) : [];
      const item={type:'essay',question:q,modelAnswer:model,keywords,points};
      if(editIndex!=null){ qs[editIndex]=item; editIndex=null; } else qs.push(item);
      resetEssay();
    }
    saveToStorage(); updateCount();
  };

  // Bulk import (MCQ only ‚Äì gi·ªØ nguy√™n logic c≈©)
  $('importBtn').onclick=function(){
    qs=[]; const blocks=$('bulkArea').value.trim().split(/\n\s*\n/);
    const optRx=/^\s*(\*)?\s*([A-D])\s*[\.:\/\)\-]?\s*(.+)$/i;
    blocks.forEach(b=>{
      const lines=b.split('\n').map(l=>l.trim()).filter(Boolean);
      if(lines.length<2) return; const question=lines[0].replace(/^(?:-?\s*)?(?:C√¢u)?\s*\d+\s*[:\.:\/\)\-]?\s*/i,'').trim();
      const opts=new Array(4); let correct=0; lines.slice(1).forEach(line=>{ const m=line.match(optRx); if(!m) return; const idx=m[2].toUpperCase().charCodeAt(0)-65; opts[idx]=m[3].trim(); if(m[1]) correct=idx; });
      if(opts.filter(Boolean).length===4) qs.push({type:'mcq',question,options:opts,correct,image:null});
    });
    saveToStorage(); $('bulkArea').value=''; updateCount();
  };

  // View list
  $('viewBtn').onclick=function(){ renderView(); show('view'); };
  $('backSetup').onclick=function(){ show('setup'); };

  function renderView(){
    const list=$('viewList'); list.innerHTML='';
    qs.forEach((q,i)=>{
      const card=document.createElement('div'); card.className='qcard';
      let html=`<h3>C√¢u ${i+1} (${q.type==='essay'?'T·ª± lu·∫≠n':'Tr·∫Øc nghi·ªám'})</h3><div style="color:var(--muted);margin-bottom:6px">${q.type==='essay'?'Thang ƒëi·ªÉm: '+q.points:''}</div><div>${q.question}</div>`;
      if(q.type==='mcq' && q.image) html+=`<img src="${q.image}" style="max-width:100%;margin:12px 0;border-radius:var(--radius)">`;
      if(q.type==='mcq') html+=`<ul style="margin:10px 0 0 18px">${q.options.map((o,j)=>`<li${j===q.correct?" style='font-weight:700;color:#16a34a'":''}>${String.fromCharCode(65+j)}. ${o}</li>`).join('')}</ul>`;
      if(q.type==='essay' && q.keywords?.length) html+=`<div style="margin-top:8px;color:var(--muted)"><strong>T·ª´ kho√°:</strong> ${q.keywords.join(', ')}</div>`;
      card.innerHTML=html;
      const act=document.createElement('div'); act.className='actions';
      const e=document.createElement('span'); e.textContent='‚úé'; e.title='S·ª≠a'; e.onclick=function(){ show('setup'); if($('bulk').classList.contains('hidden')===false) $('modeBtn').click(); // ƒë·∫£m b·∫£o ·ªü Manual
        $('qType').value=q.type; $('qType').dispatchEvent(new Event('change'));
        if(q.type==='mcq'){
          $('qInp').value=q.question; q.options.forEach((opt,j)=>$('a'+j).value=opt); $('correctSel').value=q.correct; if(q.image){ $('imgPreview').src=q.image; $('imgPreview').classList.remove('hidden'); $('clearImg').classList.remove('hidden'); }
        } else { $('essayQ').value=q.question; $('essayModel').value=q.modelAnswer||''; $('essayKeywords').value=(q.keywords||[]).join(', '); $('essayPoints').value=q.points||10; }
        editIndex=i; qs.splice(i,1); saveToStorage(); updateCount(); };
      const d=document.createElement('span'); d.textContent='‚úñ'; d.title='Xo√°'; d.onclick=function(){ if(confirm('Xo√° c√¢u n√†y?')){ qs.splice(i,1); saveToStorage(); renderView(); updateCount(); } };
      act.append(e,d); card.appendChild(act); list.appendChild(card);
    });
    const wrap=$('clearAllWrap'); wrap.innerHTML=''; if(qs.length){ const clearBtn=document.createElement('button'); clearBtn.type='button'; clearBtn.textContent='Xo√° t·∫•t c·∫£'; clearBtn.className='btn'; clearBtn.style.background='#e11d48'; clearBtn.style.marginBottom='10px'; clearBtn.onclick=function(){ if(confirm('Xo√° to√†n b·ªô ƒë·ªÅ?')){ qs=[]; localStorage.removeItem(LS_KEY); renderView(); updateCount(); } }; wrap.appendChild(clearBtn);} }

  // Quiz render
  function renderQuiz(){
    const list=$('quizList'); list.innerHTML=''; score=0; $('progbar').style.width='0%';
    qs.forEach((q,i)=>{
      const card=document.createElement('div'); card.className='qcard';
      let html=`<h3>C√¢u ${i+1}: ${q.question}</h3>`;
      if(q.type==='mcq'){
        if(q.image) html+=`<img src="${q.image}" style="max-width:100%;margin:12px 0;border-radius:var(--radius)">`;
        card.innerHTML=html;
        const wrap=document.createElement('div'); wrap.className='optwrap';
        q.options.forEach((o,j)=>{
          const op=document.createElement('div'); op.className='opt'; op.textContent=`${String.fromCharCode(65+j)}. ${o}`; op.onclick=function(){wrap.querySelectorAll('.opt').forEach(x=>x.classList.remove('selected'));op.classList.add('selected'); updateProgress();}; wrap.appendChild(op);
        });
        card.appendChild(wrap);
      } else {
        card.innerHTML=html;
        const ta=document.createElement('textarea'); ta.placeholder='Nh·∫≠p c√¢u tr·∫£ l·ªùi t·ª± lu·∫≠n...'; ta.spellcheck=spell; ta.oninput=updateProgress; card.appendChild(ta);
      }
      list.appendChild(card);
    });
  }

  function updateProgress(){
    const cards=[...document.querySelectorAll('#quizList .qcard')];
    let answered=0; cards.forEach(c=>{ const mc=c.querySelector('.opt.selected'); const ta=c.querySelector('textarea'); if(mc || (ta && ta.value.trim())) answered++; });
    const pct = cards.length? Math.round(answered*100/cards.length) : 0; $('progbar').style.width=pct+'%';
  }

  // Submit
  $('submitBtn').onclick=function(){
    // gather answers
    const userAnswers=[];
    document.querySelectorAll('#quizList .qcard').forEach((card,i)=>{
      const ta=card.querySelector('textarea');
      if(ta){ userAnswers.push({type:'essay', text:ta.value}); }
      else{
        const sel=card.querySelector('.opt.selected'); const idx= sel? sel.textContent.charCodeAt(0)-65 : null; userAnswers.push({type:'mcq', idx});
      }
    });

    // scoring
    let totalPoints=0; let totalEarned=0; const details=[];

    userAnswers.forEach((ans,i)=>{
      const q=qs[i];
      if(q.type==='mcq'){
        totalPoints+=1; const correct= ans.idx===q.correct; if(correct) totalEarned+=1; details.push({type:'mcq',correct, your:ans.idx, correctIdx:q.correct, options:q.options});
      } else {
        const points=q.points||10; totalPoints+=points; const text=(ans.text||'').trim();
        const kw = expandKeywords(q.keywords||[]);
        const toks=tokenize(text); const modelToks=tokenize(q.modelAnswer||'');
        const present=[]; const missing=[];
        kw.forEach(k=>{ const hit = toks.join(' ').includes(k) || toks.some(w=>w===k); (hit?present:missing).push(k); });
        const kwCoverage = kw.length? present.length/kw.length : 0; // 0..1
        const sim = modelToks.length? jaccardSim(new Set(toks), new Set(modelToks)) : 0; // 0..1
        const wKw=0.7, wSim=0.3; const raw= wKw*kwCoverage + wSim*sim; const earned = Math.round(raw*points*10)/10; totalEarned+=earned;
        details.push({type:'essay', earned, points, text, model:q.modelAnswer||'', present, missing, kwCoverage, sim});
      }
    });

    score=totalEarned; // for display

    // decorate UI for MCQ
    document.querySelectorAll('#quizList .qcard').forEach((card,i)=>{
      const q=qs[i]; const d=details[i];
      if(q.type==='mcq'){
        const opts=card.querySelectorAll('.opt');
        opts.forEach((opt,j)=>{
          opt.onclick=null; opt.classList.remove('correct','wrong');
          if(j===q.correct) opt.classList.add('correct');
          if(d.your===j && j!==q.correct) opt.classList.add('wrong');
        });
      } else {
        const ta=card.querySelector('textarea'); if(!ta) return; ta.readOnly=true; ta.style.borderColor = d.earned>=(q.points*0.6)? '#16a34a' : '#ef4444'; ta.classList.add(d.earned>=(q.points*0.6)?'correct':'wrong');
        const fb=document.createElement('div'); fb.style.marginTop='8px'; fb.style.color='var(--muted)';
        fb.innerHTML=`<strong>ƒêi·ªÉm t·∫°m t√≠nh:</strong> ${d.earned}/${d.points} ¬∑ <strong>T·ª´ kho√°</strong>: ‚úÖ ${d.present.length}${d.missing.length?` ¬∑ ‚ùå ${d.missing.length}`:''} ¬∑ <strong>T∆∞∆°ng ƒë·ªìng</strong>: ${(d.sim*100).toFixed(0)}%`;
        card.appendChild(fb);
      }
    });

    const name=$('nameInp').value||'B·∫°n';
    $('resultTxt').innerHTML = `${name}, b·∫°n ƒë·∫°t <strong>${Math.round(totalEarned*100)/100}/${totalPoints}</strong> ƒëi·ªÉm.`;
    show('result');

    // Prepare detailed review content
    const answerHTML = details.map((d,i)=>{
      if(d.type==='mcq'){
        const your = d.your!=null? `${String.fromCharCode(65+d.your)}. ${d.options[d.your]}` : 'Kh√¥ng ch·ªçn';
        const corr = `${String.fromCharCode(65+d.correctIdx)}. ${d.options[d.correctIdx]}`;
        return `<div class="qcard"><h3>C√¢u ${i+1} (Tr·∫Øc nghi·ªám)</h3><p><strong>ƒê√°p c·ªßa b·∫°n:</strong> ${your} ‚Üí <strong>ƒê√∫ng:</strong> ${corr}</p></div>`;
      } else {
        const mk = `<div style='margin-top:6px'><strong>ƒêi·ªÉm:</strong> ${d.earned}/${d.points} ¬∑ <strong>T·ª´ kho√° ƒë·∫°t:</strong> ${d.present.join(', ')||'‚Äî'}${d.missing.length?` ¬∑ <strong>C√≤n thi·∫øu:</strong> ${d.missing.join(', ')}`:''} ¬∑ <strong>T∆∞∆°ng ƒë·ªìng:</strong> ${(d.sim*100).toFixed(0)}%</div>`;
        const modelBlock = d.model? `<details style='margin-top:8px'><summary style='cursor:pointer'>Xem ƒë√°p √°n m·∫´u</summary><div style='margin-top:6px;white-space:pre-wrap;background:#f8fafc;padding:10px;border-radius:12px'>${d.model}</div></details>` : '';
        return `<div class="qcard"><h3>C√¢u ${i+1} (T·ª± lu·∫≠n)</h3><div style='white-space:pre-wrap'>${d.text || '<i>(Kh√¥ng tr·∫£ l·ªùi)</i>'}</div>${mk}${modelBlock}</div>`;
      }
    }).join('');
    $('answerList').innerHTML=answerHTML;
  };

  $('retryBtn').onclick=function(){ renderQuiz(); show('quiz'); };
  $('homeBtn').onclick=function(){ qs=[]; score=0; ['nameInp'].forEach(id=>$(id).value=''); updateCount(); resetManual(); show('setup'); saveToStorage(); };
  $('viewAnswerBtn').onclick=function(){ show('answerReview'); };
  $('backResultBtn').onclick=function(){ show('result'); };

})();
</script></body>
</html>    .qcard{background:#fff;border:2px solid transparent;border-radius:var(--radius);padding:18px;margin-bottom:20px;box-shadow:var(--shadow);position:relative;transition:var(--t)}
    .qcard:hover{border-color:var(--primary);transform:translateY(-2px)}
    .qcard h3{margin:0 0 14px;font-size:1.05rem;font-weight:600}
    .actions{position:absolute;top:10px;right:12px;display:flex;gap:10px;font-size:18px;color:#64748b}
    .actions span{cursor:pointer;transition:var(--t)}
    .actions span:hover{color:var(--primary);transform:scale(1.15)}
    .optwrap{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .opt{border:2px solid var(--primary);border-radius:var(--radius);padding:12px;text-align:center;background:#f8fafc;cursor:pointer;transition:var(--t);user-select:none}
    .opt.selected{background:var(--primary);color:#fff;transform:scale(1.03)}
    #login{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:40}
    #loginBox{background:#fff;padding:32px;border-radius:var(--radius);width:90%;max-width:380px;box-shadow:var(--shadow);text-align:center;position:relative}
    #closeLogin{position:absolute;top:10px;right:12px;font-size:22px;color:#64748b;cursor:pointer;transition:var(--t)}
    #closeLogin:hover{color:var(--primary);transform:scale(1.15)}
    @keyframes fadeSlide{0%{opacity:0;transform:translateY(10px)}100%{opacity:1;transform:translateY(0)}}
    @media(max-width:640px){
      .card{width:100vw;border-radius:0}
      .optwrap{grid-template-columns:1fr}
    }
    .hidden { display: none !important; }
    /* Image preview */
    #imgPreview { max-width: 100%; max-height: 150px; margin-top: 6px; border-radius: var(--radius); }
    .remove-img { margin-left: 8px; cursor: pointer; color: #e11d48; background: none; border: none; font-size: 14px; }
  </style>
</head>
<body>
<div id="app">
  <div id="card" class="card">
    <header>
      <button id="userBtn" type="button">üë§</button>
      <h1>H·ªá Th·ªëng Tr·∫Øc Nghi·ªám</h1>
      <button id="gear" type="button">‚öôÔ∏è</button>
    </header>
    <!-- LOGIN -->
    <div id="login" class="hidden">
      <div id="loginBox">
        <span id="closeLogin">‚úñ</span>
        <h2 style="margin:28px 0 18px">Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i</h2>
        <input id="nameInp" placeholder="T√™n c·ªßa b·∫°n" spellcheck>
        <button id="startBtn" class="btn" style="margin-top:12px;width:100%" type="button">B·∫Øt ƒë·∫ßu</button>
      </div>
    </div>

    <!-- SETUP -->
    <div id="setup" class="screen">
      <button id="modeBtn" class="btn" style="background:#38bdf8" type="button">Nh·∫≠p nhanh</button>
      <div id="manual" style="margin-top:12px">
        <input id="qInp" placeholder="C√¢u h·ªèi">
        <input id="a0" placeholder="ƒê√°p √°n A"><input id="a1" placeholder="ƒê√°p √°n B">
        <input id="a2" placeholder="ƒê√°p √°n C"><input id="a3" placeholder="ƒê√°p √°n D">
        <select id="correctSel"></select>
        <!-- Image upload -->
        <input id="imgInp" type="file" accept="image/*">
        <img id="imgPreview" class="hidden" />
        <button id="clearImg" class="remove-img hidden" type="button">X√≥a ·∫£nh</button>
        <button id="addBtn" class="btn" style="margin-top:6px" type="button">Th√™m c√¢u h·ªèi</button>
      </div>
      <div id="bulk" class="hidden" style="margin-top:12px">
        <textarea id="bulkArea" rows="6" placeholder="D√°n ƒë·ªãnh d·∫°ng nhanh‚Ä¶"></textarea>
        <button id="importBtn" class="btn" style="margin-top:6px" type="button">Import nhanh</button>
      </div>
      <p id="count" style="margin-top:10px;font-weight:500"></p>
      <button id="viewBtn" class="btn" style="margin-top:6px;background:#1163ff" type="button">ƒê·ªÅ hi·ªán t·∫°i</button>
    </div>

    <!-- VIEW -->
    <div id="view" class="screen hidden">
      <h2 style="margin-bottom:14px">ƒê·ªÅ hi·ªán t·∫°i</h2>
      <div id="viewList"></div>
      <div id="clearAllWrap"></div>
      <button id="backSetup" class="btn" style="background:#64748b" type="button">Quay l·∫°i ch·ªânh ƒë·ªÅ</button>
    </div>

    <!-- QUIZ -->
    <div id="quiz" class="screen hidden">
      <div id="quizList"></div>
      <button id="submitBtn" class="btn" style="margin-top:10px" type="button">N·ªôp b√†i</button>
    </div>

    <!-- RESULT -->
    <!-- RESULT -->
<div id="result" class="screen hidden">
  <h2>K·∫øt qu·∫£</h2>
  <p id="resultTxt" style="font-size:1.2rem;font-weight:600"></p>
  <div style="margin-top:14px;display:flex;gap:12px">
    <button id="retryBtn" class="btn" style="flex:1" type="button">L√†m l·∫°i</button>
    <button id="homeBtn" class="btn" style="flex:1;background:#64748b" type="button">Trang ch·ªß</button>
    <button id="viewAnswerBtn" class="btn" style="flex:1;background:#38bdf8" type="button">Xem ƒë√°p √°n</button>
  </div>
</div>

<!-- ANSWER REVIEW -->
<div id="answerReview" class="screen hidden">
  <h2>ƒê√°p √°n chi ti·∫øt</h2>
  <div id="answerList"></div>
  <button id="backResultBtn" class="btn" style="margin-top:14px;background:#64748b" type="button">Quay l·∫°i k·∫øt qu·∫£</button>
</div>

    <!-- SETTINGS -->
    <div id="settings">
      <button id="toggleSQ" class="btn" type="button">X√°o c√¢u h·ªèi: B·∫≠t</button>
      <button id="toggleSA" class="btn" type="button">X√°o ƒë√°p √°n: B·∫≠t</button>
      <button id="toggleSpell" class="btn" type="button">Spellcheck: B·∫≠t</button>
      <button id="fsBtn" class="btn" type="button">To√†n m√†n h√¨nh</button>
      <input id="colorPick" type="color" value="#6366f1" style="margin-top:12px">
    </div>
  </div>
</div>
<script>
(function(){
  const $=id=>document.getElementById(id);
  let qs=[],score=0,shuffleQ=true,shuffleA=true,spell=true, editIndex=null;
  const LS_KEY = 'tao-cau-hoi-trac-nghiem-qs';

  function saveToStorage() {
    localStorage.setItem(LS_KEY, JSON.stringify(qs));
  }
  function loadFromStorage() {
    try {
      const data = JSON.parse(localStorage.getItem(LS_KEY));
      if(Array.isArray(data)) qs = data;
    } catch {}
  }

  function updateCount(){ $('count').textContent=`${qs.length} c√¢u h·ªèi`; }
  function resetManual(){
    $('qInp').value='';[...'0123'].forEach(i=>$('a'+i).value='');$('correctSel').value=0;
    $('imgInp').value='';$('imgPreview').classList.add('hidden');$('clearImg').classList.add('hidden'); editIndex=null;
  }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} }
  function show(k){ Object.values(screens).forEach(s=>s.classList.toggle('hidden',s!==screens[k])); }

  const screens={
    setup:$('setup'),view:$('view'),quiz:$('quiz'),result:$('result')
  };

  // --- INIT ---
  document.addEventListener('DOMContentLoaded',function(){
    // N·∫°p storage tr∆∞·ªõc khi render
    loadFromStorage();
    updateCount();
    for(let i=0;i<4;i++){ const o=document.createElement('option'); o.value=i; o.textContent=String.fromCharCode(65+i); $('correctSel').appendChild(o);}
  });

  // Image preview
  $('imgInp').onchange = function(e){
    const file = e.target.files[0];
    if(file){
      const url = URL.createObjectURL(file);
      $('imgPreview').src = url;
      $('imgPreview').classList.remove('hidden');
      $('clearImg').classList.remove('hidden');
    }
  };
  $('clearImg').onclick = function(){
    $('imgInp').value=''; $('imgPreview').src=''; $('imgPreview').classList.add('hidden'); $('clearImg').classList.add('hidden');
  };

  // LOGIN
  $('userBtn').onclick=function(){$('login').classList.remove('hidden');};
  $('closeLogin').onclick=function(){$('login').classList.add('hidden');};
  $('login').onclick=function(e){ if(e.target.id==='login')$('login').classList.add('hidden'); };

  $('startBtn').onclick=function(){
    if(!$('nameInp').value.trim()) return alert('Nh·∫≠p t√™n');
    if(!qs.length) return alert('H√£y nh·∫≠p c√¢u h·ªèi tr∆∞·ªõc!');
    $('login').classList.add('hidden');
    if(shuffleQ) shuffle(qs);
    if(shuffleA) qs.forEach(q=>{
      const p=q.options.map((o,i)=>({o,i})); shuffle(p);
      q.options=p.map(x=>x.o);
      q.correct=p.findIndex(x=>x.i===q.correct);
    });
    renderQuiz(); show('quiz');
  };

  // SETTINGS
  $('gear').onclick=function(e){
    e.stopPropagation();
    $('settings').style.display=$('settings').style.display==='block'?'none':'block';
  };
  document.addEventListener('click',function(e){
    if(!$('settings').contains(e.target)&&e.target!=$('gear'))$('settings').style.display='none'
  });
  $('colorPick').oninput=function(e){
    document.documentElement.style.setProperty('--primary',e.target.value);
  };
  $('toggleSQ').onclick=function(){
    shuffleQ=!shuffleQ; this.textContent=`X√°o c√¢u h·ªèi: ${shuffleQ?'B·∫≠t':'T·∫Øt'}`;
  };
  $('toggleSA').onclick=function(){
    shuffleA=!shuffleA; this.textContent=`X√°o ƒë√°p √°n: ${shuffleA?'B·∫≠t':'T·∫Øt'}`;
  };
  $('toggleSpell').onclick=function(){
    spell=!spell; $('nameInp').spellcheck=spell; this.textContent=`Spellcheck: ${spell?'B·∫≠t':'T·∫Øt'}`;
  };
  $('fsBtn').onclick=function(){
    const c=$('card');
    if(!document.fullscreenElement){
      c.requestFullscreen();$('fsBtn').textContent='Tho√°t FS';
    }else{
      document.exitFullscreen();$('fsBtn').textContent='To√†n m√†n h√¨nh';
    }
  };

  // SETUP
  $('modeBtn').onclick=function(){
    const m=$('manual').classList.toggle('hidden');
    $('bulk').classList.toggle('hidden');
    $('modeBtn').textContent=m?'Nh·∫≠p nhanh':'Nh·∫≠p th·ªß c√¥ng';
  };

  $('addBtn').onclick=function(){
    const qText=$('qInp').value.trim();
    const opts=[...'0123'].map(i=>$('a'+i).value.trim());
    const ci=+$('correctSel').value;
    if(!qText||opts.some(o=>!o)) return alert('Thi·∫øu d·ªØ li·ªáu');
    const imgSrc = $('imgPreview').src || null;
    const questionObj = {question:qText,options:opts,correct:ci,image: imgSrc};
    if(editIndex!=null){ qs[editIndex]=questionObj; }
    else{ qs.push(questionObj); }
    saveToStorage();
    updateCount(); resetManual();
  };

  $('importBtn').onclick = function() {
    qs=[]; const blocks=$('bulkArea').value.trim().split(/\n\s*\n/);
    const optRx=/^\s*(\*)?\s*([A-D])\s*[\.\/:\)\-]?\s*(.+)$/i;
    blocks.forEach(b=>{
      const lines=b.split('\n').map(l=>l.trim()).filter(Boolean);
      if(lines.length<2) return;
      const question=lines[0].replace(/^(?:-?\s*)?(?:C√¢u)?\s*\d+\s*[:\.\/:\)\-]?\s*/i,'').trim();
      const opts=new Array(4); let correct=0;
      lines.slice(1).forEach(line=>{
        const m=line.match(optRx);if(!m) return;
        const idx=m[2].toUpperCase().charCodeAt(0)-65; opts[idx]=m[3].trim(); if(m[1])correct=idx;
      });
      if(opts.filter(Boolean).length===4) qs.push({question,options:opts,correct,image:null});
    });
    saveToStorage();
    $('bulkArea').value=''; updateCount();
  };

  $('viewBtn').onclick=function(){ renderView(); show('view'); };
  $('backSetup').onclick=function(){ show('setup'); };

  function renderView(){
    const list=$('viewList'); list.innerHTML='';
    qs.forEach((q,i)=>{
      const card=document.createElement('div'); card.className='qcard';
      let html=`<h3>C√¢u ${i+1}: ${q.question}</h3>`;
      if(q.image) html+=`<img src="${q.image}" style="max-width:100%;margin:12px 0;border-radius:var(--radius)">`;
      card.innerHTML=html;
      const act=document.createElement('div'); act.className='actions';
      const e=document.createElement('span'); e.textContent='‚úé'; e.onclick=function(){
        show('setup'); if($('manual').classList.contains('hidden')) $('modeBtn').click();
        $('qInp').value=q.question; q.options.forEach((opt,j)=>$('a'+j).value=opt);
        $('correctSel').value=q.correct;
        if(q.image){ $('imgPreview').src=q.image; $('imgPreview').classList.remove('hidden'); $('clearImg').classList.remove('hidden'); }
        editIndex=i; qs.splice(i,1);
        saveToStorage();
        updateCount();
      };
      const d=document.createElement('span'); d.textContent='‚úñ'; d.onclick=function(){qs.splice(i,1); saveToStorage(); renderView(); updateCount();};
      act.append(e,d); card.appendChild(act);
      list.appendChild(card);
    });
    // N√∫t x√≥a t·∫•t c·∫£: ch·ªâ render khi c√≥ c√¢u h·ªèi
    const wrap = $('clearAllWrap');
    wrap.innerHTML = '';
    if(qs.length) {
      const clearBtn = document.createElement('button');
      clearBtn.type = 'button';
      clearBtn.textContent = 'X√≥a t·∫•t c·∫£';
      clearBtn.className = 'btn';
      clearBtn.style.background = '#e11d48';
      clearBtn.style.marginBottom = '10px';
      clearBtn.onclick = function () {
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô ƒë·ªÅ?')) {
          qs = [];
          localStorage.removeItem(LS_KEY);
          renderView();
          updateCount();
        }
      };
      wrap.appendChild(clearBtn);
    }
  }

  // QUIZ
  function renderQuiz(){
    const list=$('quizList'); list.innerHTML=''; score=0;
    qs.forEach((q,i)=>{
      const card=document.createElement('div'); card.className='qcard';
      let html=`<h3>C√¢u ${i+1}: ${q.question}</h3>`;
      if(q.image) html+=`<img src="${q.image}" style="max-width:100%;margin:12px 0;border-radius:var(--radius)">`;
      card.innerHTML=html;
      const wrap=document.createElement('div'); wrap.className='optwrap';
      q.options.forEach((o,j)=>{
        const op=document.createElement('div'); op.className='opt'; op.textContent=`${String.fromCharCode(65+j)}. ${o}`;
        op.onclick=function(){wrap.querySelectorAll('.opt').forEach(x=>x.classList.remove('selected'));op.classList.add('selected');};
        wrap.appendChild(op);
      });
      card.appendChild(wrap); list.appendChild(card);
    });
  }
  $('submitBtn').onclick = function() {
    // 1. Thu th·∫≠p c√¢u tr·∫£ l·ªùi c·ªßa ng∆∞·ªùi ch∆°i
    const userAnswers = [];
    document.querySelectorAll('#quizList .qcard').forEach((card, i) => {
      const sel = card.querySelector('.opt.selected');
      const idx = sel ? sel.textContent.charCodeAt(0) - 65 : null;
      userAnswers.push(idx);
    });

    // 2. T√≠nh ƒëi·ªÉm
    score = 0;
    userAnswers.forEach((ans, i) => {
      if (ans === qs[i].correct) score++;
    });

    // 3. V√¥ hi·ªáu ho√° ch·ªçn l·∫°i v√† x√≥a class c≈©
    document.querySelectorAll('#quizList .opt').forEach(opt => {
      opt.onclick = null;
      opt.classList.remove('correct','wrong');
    });

    // 4. G·∫Øn class .correct / .wrong cho t·ª´ng ƒë√°p √°n
    document.querySelectorAll('#quizList .qcard').forEach((card, i) => {
      const opts = card.querySelectorAll('.opt');
      opts.forEach((opt, j) => {
        if (j === qs[i].correct) {
          opt.classList.add('correct');
        }
        if (userAnswers[i] === j && j !== qs[i].correct) {
          opt.classList.add('wrong');
        }
      });
    });

    // 5. Hi·ªÉn th·ªã k·∫øt qu·∫£ v√† chi ti·∫øt
    let detailHTML = userAnswers.map((ans, i) => {
      const correctIdx = qs[i].correct;
      const yourText = ans != null
        ? `${String.fromCharCode(65+ans)}. ${qs[i].options[ans]}`
        : 'Kh√¥ng ch·ªçn';
      const corrText = `${String.fromCharCode(65+correctIdx)}. ${qs[i].options[correctIdx]}`;
      return `<p>C√¢u ${i+1}: <strong>ƒê√°p c·ªßa b·∫°n:</strong> ${yourText} ‚Üí <strong>ƒê√°p ƒë√∫ng:</strong> ${corrText}</p>`;
    }).join('');

    $('resultTxt').innerHTML = `
      ${$('nameInp').value}, b·∫°n ƒë√∫ng ${score}/${qs.length} c√¢u.
      <div style="margin-top:12px;line-height:1.5em">
        ${detailHTML}
      </div>
    `;

    show('result');
  };
  $('retryBtn').onclick=function(){ renderQuiz(); show('quiz'); };
  $('homeBtn').onclick=function(){ qs=[]; score=0; $('nameInp').value=''; updateCount(); resetManual(); show('setup'); saveToStorage(); };

})();
</script>
</body>
</html>
