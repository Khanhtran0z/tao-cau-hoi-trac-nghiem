<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hệ Thống Trắc Nghiệm</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    /* ========== THEME ========== */
    :root{
      --primary:#6366f1;
      --primary-dark:#4f46e5;
      --bg:#f1f5f9;
      --card:#ffffff;
      --txt:#1e293b;
      --radius:14px;
      --shadow:0 6px 18px rgb(0 0 0 / .08);
      --t:all .25s cubic-bezier(.4,0,.2,1)
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:"Inter",sans-serif;background:var(--bg);color:var(--txt)}
    #app{height:100%;display:flex;align-items:center;justify-content:center;padding:16px}
    /* ---------- CARD ---------- */
    .card{width:90vw;max-width:880px;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);display:flex;flex-direction:column;overflow:hidden}
    .card.full{width:100vw;height:100vh;border-radius:0}
    /* ---------- HEADER ---------- */
    header{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);padding:20px 24px;color:#fff;display:flex;justify-content:center;align-items:center;position:relative}
    header h1{margin:0;font-size:1.75rem;font-weight:600;letter-spacing:-.5px}
    #gear{position:absolute;top:18px;right:20px;width:42px;height:42px;border:none;border-radius:50%;background:rgba(255,255,255,.15);backdrop-filter:blur(4px);display:grid;place-items:center;font-size:20px;color:#fff;cursor:pointer;transition:var(--t)}
    #gear:hover{background:rgba(255,255,255,.25);transform:rotate(90deg)}
    /* ---------- SETTINGS PANEL ---------- */
    #settings{position:absolute;top:75px;right:20px;background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;width:240px;display:none;z-index:20}
    #settings .btn{width:100%;margin-top:10px}
    /* ---------- SCREENS ---------- */
    .screen{padding:28px;overflow-y:auto;flex:1;animation:fadeSlide .4s}
    .hidden{display:none}
    /* ---------- FORM & BTN ---------- */
    input,textarea,select{width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:var(--radius);font-size:1rem;margin:10px 0;transition:var(--t)}
    input:focus,textarea:focus,select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgb(99 102 241 / .25)}
    .btn{background:var(--primary);color:#fff;border:none;border-radius:var(--radius);padding:12px 20px;font-weight:500;cursor:pointer;transition:var(--t);box-shadow:0 2px 6px rgb(0 0 0 / .1)}
    .btn:hover{background:var(--primary-dark);transform:translateY(-1px)}
    /* ---------- QUESTION CARD ---------- */
    .qcard{background:#fff;border:2px solid transparent;border-radius:var(--radius);padding:18px;margin-bottom:20px;position:relative;box-shadow:var(--shadow);transition:var(--t)}
    .qcard:hover{border-color:var(--primary);transform:translateY(-2px)}
    .qcard h3{margin:0 0 14px;font-size:1.1rem;font-weight:600}
    .actions{position:absolute;top:10px;right:12px;display:flex;gap:10px;color:#64748b;font-size:18px}
    .actions span{cursor:pointer;transition:var(--t)}
    .actions span:hover{color:var(--primary);transform:scale(1.15)}
    /* ---------- OPTIONS ---------- */
    .optwrap{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .opt{border:2px solid var(--primary);border-radius:var(--radius);padding:12px;text-align:center;background:#f8fafc;cursor:pointer;transition:var(--t);user-select:none}
    .opt.selected{background:var(--primary);color:#fff;transform:scale(1.03)}
    /* ---------- ANIMS ---------- */
    @keyframes fadeSlide{0%{opacity:0;transform:translateY(10px)}100%{opacity:1;transform:translateY(0)}}
    @media(max-width:640px){.card{width:100vw}.optwrap{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div id="app">
  <div id="card" class="card">
    <header>
      <h1>Hệ Thống Trắc Nghiệm</h1>
      <button id="gear">⚙️</button>
    </header>

    <!-- HOME -->
    <div id="home" class="screen">
      <input id="nameInp" placeholder="Tên của bạn" spellcheck>
      <div style="display:flex;gap:12px;margin-top:8px">
        <button id="startBtn" class="btn" style="flex:1">Bắt đầu</button>
        <button id="editBtn" class="btn" style="flex:1;background:#64748b">Chỉnh sửa đề</button>
      </div>
    </div>

    <!-- SETUP -->
    <div id="setup" class="screen hidden">
      <button id="modeBtn" class="btn" style="background:#38bdf8">Nhập nhanh</button>

      <div id="manual" style="margin-top:12px">
        <input id="qInp" placeholder="Câu hỏi">
        <input id="a0" placeholder="Đáp án A">
        <input id="a1" placeholder="Đáp án B">
        <input id="a2" placeholder="Đáp án C">
        <input id="a3" placeholder="Đáp án D">
        <select id="correctSel"></select>
        <button id="addBtn" class="btn" style="margin-top:6px">Thêm câu hỏi</button>
      </div>

      <div id="bulk" class="hidden" style="margin-top:12px">
        <textarea id="bulkArea" rows="6" placeholder="Dán định dạng nhanh…"></textarea>
        <button id="importBtn" class="btn" style="margin-top:6px">Import nhanh</button>
      </div>

      <p id="count" style="margin-top:10px;font-weight:500"></p>
      <button id="viewBtn" class="btn" style="margin-top:6px;background:#1163ff">Đề hiện tại</button>
    </div>

    <!-- VIEW -->
    <div id="view" class="screen hidden">
      <h2 style="margin-bottom:14px">Đề hiện tại</h2>
      <div id="viewList"></div>
      <button id="backSetup" class="btn" style="background:#64748b">Quay lại chỉnh đề</button>
    </div>

    <!-- QUIZ -->
    <div id="quiz" class="screen hidden">
      <div id="quizList"></div>
      <button id="submitBtn" class="btn" style="margin-top:10px">Nộp bài</button>
    </div>

    <!-- RESULT -->
    <div id="result" class="screen hidden">
      <h2>Kết quả</h2>
      <p id="resultTxt" style="font-size:1.2rem;font-weight:600"></p>
      <div style="margin-top:14px;display:flex;gap:12px">
        <button id="retryBtn" class="btn" style="flex:1">Làm lại</button>
        <button id="homeBtn" class="btn" style="flex:1;background:#64748b">Trang chủ</button>
      </div>
    </div>

    <!-- SETTINGS -->
    <div id="settings">
      <button id="toggleSQ" class="btn">Xáo câu hỏi: Bật</button>
      <button id="toggleSA" class="btn">Xáo đáp án: Bật</button>
      <button id="toggleSpell" class="btn">Spellcheck: Bật</button>
      <button id="fsBtn" class="btn">Toàn màn hình</button>
      <input id="colorPick" type="color" value="#6366f1">
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{

  /* === helper === */
  const $=id=>document.getElementById(id);
  const screens={home:$('home'),setup:$('setup'),view:$('view'),quiz:$('quiz'),result:$('result')};
  const show=s=>{Object.values(screens).forEach(el=>el.classList.toggle('hidden',el!==screens[s]))};

  /* === state === */
  let qs=[],score=0,shuffleQ=true,shuffleA=true,spell=true;
  const updateCount=()=>$('count').textContent=`${qs.length} câu hỏi`;
  const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}};

  /* ---------- settings panel ---------- */
  $('gear').onclick=e=>{e.stopPropagation();$('settings').style.display=$('settings').style.display==='block'?'none':'block'};
  document.addEventListener('click',e=>{if(!$('settings').contains(e.target)&&e.target!=$('gear'))$('settings').style.display='none'});
  $('colorPick').oninput=e=>document.documentElement.style.setProperty('--primary',e.target.value);
  $('toggleSQ').onclick=()=>{shuffleQ=!shuffleQ;$('toggleSQ').textContent=`Xáo câu hỏi: ${shuffleQ?'Bật':'Tắt'}`};
  $('toggleSA').onclick=()=>{shuffleA=!shuffleA;$('toggleSA').textContent=`Xáo đáp án: ${shuffleA?'Bật':'Tắt'}`};
  $('toggleSpell').onclick=()=>{spell=!spell;$('nameInp').spellcheck=spell;$('toggleSpell').textContent=`Spellcheck: ${spell?'Bật':'Tắt'}`};
  $('fsBtn').onclick=()=>{if(!document.fullscreenElement){$('card').requestFullscreen();$('fsBtn').textContent='Thoát FS'}else{document.exitFullscreen();$('fsBtn').textContent='Toàn màn hình'}};

  /* ---------- HOME ---------- */
  $('editBtn').onclick=()=>show('setup');

  /* mode switch */
  $('modeBtn').onclick=()=>{
    $('manual').classList.toggle('hidden');
    $('bulk').classList.toggle('hidden');
    $('modeBtn').textContent=$('manual').classList.contains('hidden')?'Nhập thủ công':'Nhập nhanh';
  };

  /* add question manually */
  $('addBtn').onclick=()=>{
    const q=$('qInp').value.trim(),
          opts=[...'0123'].map(i=>$('a'+i).value.trim()),
          ci=+$('correctSel').value;
    if(!q||opts.some(o=>!o)) return alert('Thiếu dữ liệu');
    qs.push({question:q,options:opts,correct:ci});
    $('qInp').value=''; [...'0123'].forEach(i=>$('a'+i).value='');
    updateCount();
  };

  /* import bulk */
  $('importBtn').onclick=()=>{
    qs=[];
    $('bulkArea').value.split(/\\n\\s*\\n/).forEach(block=>{
      const lines=block.split(/\\n/).map(l=>l.trim()).filter(Boolean);
      if(lines.length<2) return;
      const q=lines[0].replace(/^Câu\\s*\\d+:/,'').trim();
      const opts=[], ci=lines.slice(1).reduce((c,l)=>{
        const m=l.match(/\\*?([A-D])\\.\\s*(.+)/);
        if(m){const idx=m[1].charCodeAt(0)-65;opts[idx]=m[2];return l.startsWith('*')?idx:c;}
        return c;
      },0);
      if(opts.length===4) qs.push({question:q,options:opts,correct:ci});
    });
    $('bulkArea').value='';
    updateCount();
  };

  /* view current */
  $('viewBtn').onclick=()=>{show('view');renderView();};
  $('backSetup').onclick=()=>show('setup');

  const renderView=()=>{
    const box=$('viewList'); box.innerHTML='';
    qs.forEach((q,i)=>{
      const card=document.createElement('div'); card.className='qcard';
      card.innerHTML=`<h3>Câu ${i+1}: ${q.question}</h3>`;
      const act=document.createElement('div');act.className='actions';
      const edit=document.createElement('span');edit.textContent='✎'; edit.onclick=()=>{ show('setup');$('manual').classList.remove('hidden');$('bulk').classList.add('hidden');$('modeBtn').textContent='Nhập nhanh';$('qInp').value=q.question;[...'0123'].forEach(j=>$('a'+j).value=q.options[j]);$('correctSel').value=q.correct;qs.splice(i,1);updateCount(); };
      const del=document.createElement('span');del.textContent='✖'; del.onclick=()=>{qs.splice(i,1);renderView();updateCount();};
      act.append(edit,del); card.appendChild(act); box.appendChild(card);
    });
  };

  /* start quiz */
  $('startBtn').onclick=()=>{
    if(!$('nameInp').value.trim()) return alert('Nhập tên');
    if(!qs.length) return alert('Chưa có đề');
    // shuffle
    if(shuffleQ) shuffle(qs);
    if(shuffleA) qs.forEach(q=>{const pair=q.options.map((o,i)=>({o,i}));shuffle(pair);q.options=pair.map(x=>x.o);q.correct=pair.findIndex(x=>x.i===q.correct);});
    renderQuiz(); show('quiz');
  };

  const renderQuiz=()=>{
    $('quizList').innerHTML=''; score=0;
    qs.forEach((q,i)=>{
      const card=document.createElement('div'); card.className='qcard';
      card.innerHTML=`<h3>Câu ${i+1}: ${q.question}</h3>`;
      const wrap=document.createElement('div'); wrap.className='optwrap';
      q.options.forEach((o,j)=>{
        const op=document.createElement('div'); op.className='opt'; op.textContent=`${String.fromCharCode(65+j)}. ${o}`;
        op.onclick=()=>{wrap.querySelectorAll('.opt').forEach(x=>x.classList.remove('selected')); op.classList.add('selected');};
        wrap.appendChild(op);
      });
      card.appendChild(wrap); $('quizList').appendChild(card);
    });
  };

  $('submitBtn').onclick=()=>{
    document.querySelectorAll('#quizList .qcard').forEach((c,i)=>{
      const sel=c.querySelector('.opt.selected');
      if(sel && sel.textContent.startsWith(String.fromCharCode(65+qs[i].correct)+'.')) score++;
    });
    $('resultTxt').textContent=`${$('nameInp').value}, bạn đúng ${score}/${qs.length} câu.`; show('result');
  };

  $('retryBtn').onclick=()=>{renderQuiz(); show('quiz');};
  $('homeBtn').onclick=()=>{qs=[];score=0;$('nameInp').value='';updateCount(); show('home');};

  /* init */
  for(let i=0;i<4;i++){const opt=document.createElement('option');opt.value=i;opt.textContent=String.fromCharCode(65+i);$('correctSel').appendChild(opt);}
  updateCount(); show('home');
});
</script>
</body>
</html>
